!function(a,b){"function"==typeof define&&define.amd?define(b):"object"==typeof exports?module.exports=b():a.pickmeup=b()}(this,function(){function a(a,b,c){if(c=c||[],a instanceof Element)b.apply(b,[a].concat(c));else{var d,e;for(d=a.length,e=0;e<d;++e)b.apply(b,[a[e]].concat(c))}}function b(b){a(b,function(a){a.parentElement.removeChild(a)})}function c(a,b){var c=a;do{c=c.parentElement}while(c&&!d(c,b));return c}function d(a,b){return(a.matches||a.webkitMatchesSelector||a.msMatchesSelector).call(a,b)}function e(a,b){return a&&a.classList.contains(b)}function f(a,b){a.classList.add(b)}function g(a,b){a.classList.remove(b)}function h(a,b){return a.querySelector(b)}function i(a,b){return Array.prototype.slice.call(a.querySelectorAll(b))}function j(a,b,c,d){if(-1!==c.indexOf(" ")){var g,e=c.split(" "),f=e.length;for(g=0;g<f;++g)j(a,b,e[g],d)}else a.__pickmeup.events.push([b,c,d]),b.addEventListener(c,d)}function k(a,b,c,d){var e,f,g;if(c&&-1!==c.indexOf(" "))for(e=c.split(" "),f=e.length,g=0;g<f;++g)k(a,b,e[g],d);else for(e=a.__pickmeup.events,f=e.length,g=0;g<f;++g)b&&b!=e[g][0]||c&&c!=e[g][1]||d&&d!=e[g][2]||e[g][0].removeEventListener(e[g][1],e[g][2])}function l(a){var b=a.getBoundingClientRect();return{top:b.top+window.pageYOffset-document.documentElement.clientTop,left:b.right+window.pageXOffset-document.documentElement.clientLeft}}function m(a,b,c){var d=document.createEvent("Event");return c&&(d.detail=c),d.initEvent("pickmeup-"+b,!1,!0),a.dispatchEvent(d)}function n(a){for(var b=new Date(a),c=28,d=b.getMonth();b.getMonth()==d;)++c,b.setDate(c);return c-1}function o(a,b){a.setDate(a.getDate()+b)}function p(a,b){var c=a.getDate();a.setDate(1),a.setMonth(a.getMonth()+b),a.setDate(Math.min(c,n(a)))}function q(a,b){var c=a.getDate();a.setDate(1),a.setFullYear(a.getFullYear()+b),a.setDate(Math.min(c,n(a)))}function r(a){var b=new Date(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0),c=new Date(a.getFullYear(),0,0,0,0,0),d=b-c;return Math.floor(d/24*60*60*1e3)}function s(a){var r,s,t,w,x,y,c=a.__pickmeup.element,d=a.__pickmeup.options,g=Math.floor(d.calendars/2),j=d.date,k=d.current,l=d.min?new Date(d.min):null,n=d.max?new Date(d.max):null;l&&(l.setDate(1),p(l,1),o(l,-1)),n&&(n.setDate(1),p(n,1),o(n,-1)),b(i(c,".pmu-instance > :not(nav)"));for(var z=0;z<d.calendars;z++)if(r=new Date(k),u(r),t=i(c,".pmu-instance")[z],e(c,"pmu-view-years")?(q(r,12*(z-g)),s=r.getFullYear()-6+" - "+(r.getFullYear()+5)):e(c,"pmu-view-months")?(q(r,z-g),s=r.getFullYear()):e(c,"pmu-view-days")&&(p(r,z-g),s=v(r,d.title_format,d.locales[d.locale])),!x&&n&&(y=new Date(r),d.select_day?p(y,d.calendars-1):d.select_month?q(y,d.calendars-1):q(y,12*(d.calendars-1)),y>n))--z,p(k,-1),x=void 0;else if(x=new Date(r),!w&&(w=new Date(r),w.setDate(1),p(w,1),o(w,-1),l&&l>w))--z,p(k,1),w=void 0;else{h(t,".pmu-month").textContent=s;var A=function(a){return"range"==d.mode&&a>=new Date(j[0]).getFullYear()&&a<=new Date(j[1]).getFullYear()||"multiple"==d.mode&&-1!==j.reduce(function(a,b){return a.push(new Date(b).getFullYear()),a},[]).indexOf(a)||new Date(j).getFullYear()==a},B=function(a,b){var c=new Date(j[0]).getFullYear(),e=new Date(j[1]).getFullYear(),f=new Date(j[0]).getMonth(),g=new Date(j[1]).getMonth();return"range"==d.mode&&(a>c&&a<e||a>c&&a==e&&b<=g||a==c&&a<e&&b>=f||a==c&&a==e&&b>=f&&b<=g)||"multiple"==d.mode&&-1!==j.reduce(function(a,b){return b=new Date(b),a.push(b.getFullYear()+"-"+b.getMonth()),a},[]).indexOf(a+"-"+b)||new Date(j).getFullYear()==a&&new Date(j).getMonth()==b};!function(){var g,h,i,a=[],b=r.getFullYear()-6,c=new Date(d.min).getFullYear(),e=new Date(d.max).getFullYear();for(i=0;i<12;++i)g=b+i,h=document.createElement("div"),h.textContent=g,h.__pickmeup_year=g,d.min&&g<c||d.max&&g>e?f(h,"pmu-disabled"):A(g)&&f(h,"pmu-selected"),a.push(h);t.appendChild(d.instance_content_template(a,"pmu-years"))}(),function(){var i,j,a=[],b=r.getFullYear(),c=new Date(d.min).getFullYear(),e=new Date(d.min).getMonth(),g=new Date(d.max).getFullYear(),h=new Date(d.max).getMonth();for(i=0;i<12;++i)j=document.createElement("div"),j.textContent=d.locales[d.locale].monthsShort[i],j.__pickmeup_month=i,j.__pickmeup_year=b,d.min&&(b<c||i<e&&b==c)||d.max&&(b>g||i>h&&b>=g)?f(j,"pmu-disabled"):B(b,i)&&f(j,"pmu-selected"),a.push(j);t.appendChild(d.instance_content_template(a,"pmu-months"))}(),function(){var e,g,h,i,j,a=[],b=r.getMonth(),c=u(new Date).valueOf();for(function(){r.setDate(1);var a=(r.getDay()-d.first_day)%7;o(r,-(a+(a<0?7:0)))}(),e=0;e<42;++e)g=document.createElement("div"),g.textContent=r.getDate(),g.__pickmeup_day=r.getDate(),g.__pickmeup_month=r.getMonth(),g.__pickmeup_year=r.getFullYear(),b!=r.getMonth()&&f(g,"pmu-not-in-month"),0==r.getDay()?f(g,"pmu-sunday"):6==r.getDay()&&f(g,"pmu-saturday"),h=d.render(new Date(r))||{},i=r.valueOf(),j=d.min&&d.min>r||d.max&&d.max<r,selected=d.date.valueOf()==i||d.date instanceof Array&&d.date.reduce(function(a,b){return a||i===b.valueOf()},!1)||"range"==d.mode&&i>=d.date[0]&&i<=d.date[1],h.disabled||!("disabled"in h)&&j?f(g,"pmu-disabled"):(h.selected||!("selected"in h)&&selected)&&f(g,"pmu-selected"),i==c&&f(g,"pmu-today"),h.class_name&&h.class_name.split(" ").forEach(f.bind(g,g)),a.push(g),o(r,1);t.appendChild(d.instance_content_template(a,"pmu-days"))}()}w.setDate(1),x.setDate(1),p(x,1),o(x,-1);var C=h(c,".pmu-prev"),D=h(c,".pmu-next");C&&(C.style.visibility=d.min&&d.min>=w?"hidden":"visible"),D&&(D.style.visibility=d.max&&d.max<=x?"hidden":"visible"),m(a,"fill")}function t(a,b){var f,c=b.format,d=b.separator,e=b.locales[b.locale];if(a instanceof Date||a instanceof Number)return u(new Date(a));if(!a)return u(new Date);if(a instanceof Array){for(a=a.slice(),f=0;f<a.length;++f)a[f]=t(a[f],b);return a}var g=a.split(d);if(g.length>1)return g.forEach(function(a,c,d){d[c]=t(a.trim(),b)}),g;var h=e.monthsShort.join(")(")+")("+e.months.join(")(");d=new RegExp("[^0-9a-zA-Z("+h+")]+");var k,l,m,n,o,i=a.split(d),j=c.split(d),p=new Date;for(f=0;f<i.length;f++)switch(j[f]){case"b":l=e.monthsShort.indexOf(i[f]);break;case"B":l=e.months.indexOf(i[f]);break;case"d":case"e":k=parseInt(i[f],10);break;case"m":l=parseInt(i[f],10)-1;break;case"Y":case"y":m=parseInt(i[f],10),m+=m>100?0:m<29?2e3:1900;break;case"H":case"I":case"k":case"l":n=parseInt(i[f],10);break;case"P":case"p":/pm/i.test(i[f])&&n<12?n+=12:/am/i.test(i[f])&&n>=12&&(n-=12);break;case"M":o=parseInt(i[f],10)}var q=new Date(void 0===m?p.getFullYear():m,void 0===l?p.getMonth():l,void 0===k?p.getDate():k,void 0===n?p.getHours():n,void 0===o?p.getMinutes():o,0);return isNaN(1*q)&&(q=new Date),u(q)}function u(a){return a.setHours(0,0,0,0),a}function v(a,b,c){var d=a.getMonth(),e=a.getDate(),f=a.getFullYear(),g=a.getDay(),i=a.getHours(),j=i>=12,k=j?i-12:i,l=r(a);0==k&&(k=12);for(var p,m=a.getMinutes(),n=a.getSeconds(),o=b.split(""),q=0;q<o.length;q++){switch(p=o[q]){case"a":p=c.daysShort[g];break;case"A":p=c.days[g];break;case"b":p=c.monthsShort[d];break;case"B":p=c.months[d];break;case"C":p=1+Math.floor(f/100);break;case"d":p=e<10?"0"+e:e;break;case"e":p=e;break;case"H":p=i<10?"0"+i:i;break;case"I":p=k<10?"0"+k:k;break;case"j":p=l<100?l<10?"00"+l:"0"+l:l;break;case"k":p=i;break;case"l":p=k;break;case"m":p=d<9?"0"+(1+d):1+d;break;case"M":p=m<10?"0"+m:m;break;case"p":case"P":p=j?"PM":"AM";break;case"s":p=Math.floor(a.getTime()/1e3);break;case"S":p=n<10?"0"+n:n;break;case"u":p=g+1;break;case"w":p=g;break;case"y":p=(""+f).substr(2,2);break;case"Y":p=f}o[q]=p}return o.join("")}function w(a,b){var e,c=a.__pickmeup.options;u(b),function(){var a;switch(c.mode){case"multiple":for(a=b.valueOf(),e=0;e<c.date.length;++e)if(c.date[e].valueOf()===a)return void c.date.splice(e,1);c.date.push(b);break;case"range":c.lastSel||(c.date[0]=b),b<=c.date[0]?(c.date[1]=c.date[0],c.date[0]=b):c.date[1]=b,c.lastSel=!c.lastSel;break;default:c.date=b.valueOf()}}();var f=y(c);d(a,"input")&&(a.value="single"==c.mode?f.formatted_date:f.formatted_date.join(c.separator)),m(a,"change",f),c.flat||!c.hide_on_select||"range"==c.mode&&c.lastSel||c.bound.hide()}function x(a,b){var h=b.target;if(e(h,"pmu-button")||(h=c(h,".pmu-button")),!e(h,"pmu-button")||e(h,"pmu-disabled"))return!1;b.preventDefault(),b.stopPropagation();var j=a.__pickmeup.options,k=c(h,".pmu-instance"),l=k.parentElement,m=i(l,".pmu-instance").indexOf(k);if(d(h.parentElement,"nav"))e(h,"pmu-month")?(p(j.current,m-Math.floor(j.calendars/2)),e(l,"pmu-view-years")?("single"!=j.mode?j.current=new Date(j.date[j.date.length-1]):j.current=new Date(j.date),j.select_day?(g(l,"pmu-view-years"),f(l,"pmu-view-days")):j.select_month&&(g(l,"pmu-view-years"),f(l,"pmu-view-months"))):e(l,"pmu-view-months")?j.select_year?(g(l,"pmu-view-months"),f(l,"pmu-view-years")):j.select_day&&(g(l,"pmu-view-months"),f(l,"pmu-view-days")):e(l,"pmu-view-days")&&(j.select_month?(g(l,"pmu-view-days"),f(l,"pmu-view-months")):j.select_year&&(g(l,"pmu-view-days"),f(l,"pmu-view-years")))):e(h,"pmu-prev")?j.bound.prev(!1):j.bound.next(!1);else if(e(l,"pmu-view-years"))j.current.setFullYear(h.__pickmeup_year),j.select_month?(g(l,"pmu-view-years"),f(l,"pmu-view-months")):j.select_day?(g(l,"pmu-view-years"),f(l,"pmu-view-days")):j.bound.update_date(j.current);else if(e(l,"pmu-view-months"))j.current.setMonth(h.__pickmeup_month),j.current.setFullYear(h.__pickmeup_year),j.select_day?(g(l,"pmu-view-months"),f(l,"pmu-view-days")):j.bound.update_date(j.current),p(j.current,Math.floor(j.calendars/2)-m);else{var n=new Date(j.current);n.setYear(h.__pickmeup_year),n.setMonth(h.__pickmeup_month),n.setDate(h.__pickmeup_day),j.bound.update_date(n)}return j.bound.fill(),!0}function y(a){var b;return"single"==a.mode?(b=new Date(a.date),{formatted_date:v(b,a.format,a.locales[a.locale]),date:b}):(b={formatted_date:[],date:[]},a.date.forEach(function(c){var d=new Date(c);b.formatted_date.push(v(d,a.format,a.locales[a.locale])),b.date.push(d)}),b)}function z(a,b){var f,c=a.__pickmeup.element;if(b||e(c,"pmu-hidden")){var h=a.__pickmeup.options,i=l(a),k={l:window.pageXOffset,t:window.pageYOffset,w:document.documentElement.clientWidth,h:document.documentElement.clientHeight},n=i.top,o=i.left;if(h.bound.fill(),d(a,"input")&&(f=a.value,f&&h.bound.set_date(f),j(a,a,"keydown",function(a){9==a.which&&h.bound.hide()}),h.lastSel=!1),!m(a,"show"))return;if(!h.flat){switch(h.position){case"top":n-=c.offsetHeight;break;case"left":o-=c.offsetWidth;break;case"right":o+=a.offsetWidth;break;case"bottom":n+=a.offsetHeight}n+c.offsetHeight>k.t+k.h&&(n=i.top-c.offsetHeight),n<k.t&&(n=i.top+a.offsetHeight),o+c.offsetWidth>k.l+k.w&&(o=i.left-c.offsetWidth),o<k.l&&(o=i.left+a.offsetWidth),c.style.top=n+2+"px",c.style.left=o-620+"px",g(c,"pmu-hidden"),setTimeout(function(){j(a,document.documentElement,"click",h.bound.hide),j(a,window,"resize",h.bound.forced_show)})}}}function A(a,b){var c=a.__pickmeup.element,d=a.__pickmeup.options;b&&b.target&&(b.target==a||16&c.compareDocumentPosition(b.target))||m(a,"hide")&&(f(c,"pmu-hidden"),k(a,document.documentElement,"click",d.bound.hide),k(a,window,"resize",d.bound.forced_show),d.lastSel=!1)}function B(a){var b=a.__pickmeup.options;k(a,document.documentElement,"click",b.bound.hide),k(a,window,"resize",b.bound.forced_show),b.bound.forced_show()}function C(a){var b=a.__pickmeup.options;"single"!=b.mode&&(b.date=[],b.lastSel=!1,b.bound.fill())}function D(a,b){void 0===b&&(b=!0);var c=a.__pickmeup.element,d=a.__pickmeup.options;e(c,"pmu-view-years")?q(d.current,-12):e(c,"pmu-view-months")?q(d.current,-1):e(c,"pmu-view-days")&&p(d.current,-1),b&&d.bound.fill()}function E(a,b){void 0===b&&(b=!0);var c=a.__pickmeup.element,d=a.__pickmeup.options;e(c,"pmu-view-years")?q(d.current,12):e(c,"pmu-view-months")?q(d.current,1):e(c,"pmu-view-days")&&p(d.current,1),b&&d.bound.fill()}function F(a,b){var c=a.__pickmeup.options,d=y(c);if("string"==typeof b){var e=d.date;return e instanceof Date?v(e,b,c.locales[c.locale]):e.map(function(a){return v(a,b,c.locales[c.locale])})}return d[b?"formatted_date":"date"]}function G(a,b,c){var f,e=a.__pickmeup.options;if(!(b instanceof Array)||b.length>0)if(e.date=t(b,e),"single"!=e.mode)for(e.date instanceof Array?(e.date[0]=e.date[0]||t(new Date,e),"range"==e.mode&&(e.date[1]=e.date[1]||t(e.date[0],e))):(e.date=[e.date],"range"==e.mode&&e.date.push(t(e.date[0],e))),f=0;f<e.date.length;++f)e.date[f]=I(e.date[f],e.min,e.max);else e.date instanceof Array&&(e.date=e.date[0]),e.date=I(e.date,e.min,e.max);else e.date=[];if(!e.select_day)if(e.date instanceof Array)for(f=0;f<e.date.length;++f)e.date[f].setDate(1);else e.date.setDate(1);if("multiple"==e.mode)for(f=0;f<e.date.length;++f)e.date.indexOf(e.date[f])!==f&&(e.date.splice(f,1),--f);if(c?e.current=t(c,e):(c="single"===e.mode?e.date:e.date[e.date.length-1],e.current=c?new Date(c):new Date),e.current.setDate(1),e.bound.fill(),d(a,"input")&&!1!==e.default_date){var g=y(e),h=a.value,i="single"==e.mode?g.formatted_date:g.formatted_date.join(e.separator);h||m(a,"change",g),h!=i&&(a.value=i)}}function H(a){var c=a.__pickmeup.element;k(a),b(c),delete a.__pickmeup}function I(a,b,c){return b&&b>a?new Date(b):c&&c<a?new Date(c):a}function J(a,b){if("string"==typeof a&&(a=document.querySelector(a)),!a)return null;if(!a.__pickmeup){var c,d,e={};b=b||{};for(c in J.defaults)e[c]=c in b?b[c]:J.defaults[c];for(c in e)null!==(d=a.getAttribute("data-pmu-"+c))&&(e[c]=d);"days"!=e.view||e.select_day||(e.view="months"),"months"!=e.view||e.select_month||(e.view="years"),"years"!=e.view||e.select_year||(e.view="days"),"days"!=e.view||e.select_day||(e.view="months"),e.calendars=Math.max(1,parseInt(e.calendars,10)||1),e.mode=/single|multiple|range/.test(e.mode)?e.mode:"single",e.min&&(e.min=t(e.min,e),e.select_day||e.min.setDate(1)),e.max&&(e.max=t(e.max,e),e.select_day||e.max.setDate(1));var g=document.createElement("div");a.__pickmeup={options:e,events:[],element:g},g.__pickmeup_target=a,f(g,"pickmeup"),e.class_name&&f(g,e.class_name),e.bound={fill:s.bind(a,a),update_date:w.bind(a,a),click:x.bind(a,a),show:z.bind(a,a),forced_show:z.bind(a,a,!0),hide:A.bind(a,a),update:B.bind(a,a),clear:C.bind(a,a),prev:D.bind(a,a),next:E.bind(a,a),get_date:F.bind(a,a),set_date:G.bind(a,a),destroy:H.bind(a,a)},f(g,"pmu-view-"+e.view);var h=e.instance_template(e),i="";for(c=0;c<e.calendars;++c)i+=h;g.innerHTML=i,j(a,g,"click",e.bound.click),j(a,g,"onselectstart"in Element.prototype?"selectstart":"mousedown",function(a){a.preventDefault()}),e.flat?(f(g,"pmu-flat"),a.appendChild(g)):(f(g,"pmu-hidden"),document.body.appendChild(g),j(a,a,"click",z.bind(a,a,!1)),j(a,a,"input",e.bound.update),j(a,a,"change",e.bound.update)),e.bound.set_date(e.date,e.current)}return e=a.__pickmeup.options,{hide:e.bound.hide,show:e.bound.show,clear:e.bound.clear,update:e.bound.update,prev:e.bound.prev,next:e.bound.next,get_date:e.bound.get_date,set_date:e.bound.set_date,destroy:e.bound.destroy}}return J.defaults={current:null,date:new Date,default_date:new Date,flat:!1,first_day:1,prev:"&#9664;",next:"&#9654;",mode:"single",select_year:!0,select_month:!0,select_day:!0,view:"days",calendars:1,format:"d-m-Y",title_format:"B, Y",position:"bottom",class_name:"",separator:" - ",hide_on_select:!1,min:null,max:null,render:function(){},locale:"en",locales:{en:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]}},instance_template:function(a){var b=a.locales[a.locale].daysMin.slice();return a.first_day&&b.push(b.shift()),'<div class="pmu-instance"><nav><div class="pmu-prev pmu-button">'+a.prev+'</div><div class="pmu-month pmu-button"></div><div class="pmu-next pmu-button">'+a.next+'</div></nav><nav class="pmu-day-of-week"><div>'+b.join("</div><div>")+"</div></nav></div>"},instance_content_template:function(a,b){var c=document.createElement("div");f(c,b);for(var d=0;d<a.length;++d)f(a[d],"pmu-button"),c.appendChild(a[d]);return c}},J});